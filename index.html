<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>SKATE Score ‚Äî Digital Game of SKATE Scorekeeper</title>
<meta name="description" content="Free digital scorekeeper for Game of SKATE. Track players, letters, rounds, and match history ‚Äî all in your browser.">
<link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='.9em' font-size='90'>üõπ</text></svg>">
<style>
*{margin:0;padding:0;box-sizing:border-box}
:root{--bg:#0a0a0a;--card:#161616;--accent:#f59e0b;--accent2:#ef4444;--text:#e5e5e5;--muted:#737373;--green:#22c55e;--radius:12px}
body{font-family:-apple-system,BlinkMacSystemFont,'Segoe UI',sans-serif;background:var(--bg);color:var(--text);min-height:100vh;padding:16px;max-width:480px;margin:0 auto}
h1{font-size:1.6rem;text-align:center;margin:12px 0 4px}
.subtitle{text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:20px}
.card{background:var(--card);border-radius:var(--radius);padding:16px;margin-bottom:12px}
button{background:var(--accent);color:#000;border:none;border-radius:8px;padding:10px 20px;font-size:.95rem;font-weight:600;cursor:pointer;transition:opacity .2s}
button:hover{opacity:.85}
button:active{transform:scale(.97)}
button.danger{background:var(--accent2);color:#fff}
button.ghost{background:transparent;color:var(--accent);border:1px solid var(--accent);padding:8px 16px;font-size:.85rem}
button.sm{padding:6px 12px;font-size:.8rem}
input{background:#222;border:1px solid #333;color:var(--text);border-radius:8px;padding:10px 12px;font-size:.95rem;width:100%}
input:focus{outline:none;border-color:var(--accent)}
.letters{display:flex;gap:6px;justify-content:center;margin:8px 0}
.letter{width:36px;height:36px;display:flex;align-items:center;justify-content:center;border-radius:8px;font-weight:700;font-size:1.1rem;background:#222;color:#555;transition:all .3s}
.letter.active{background:var(--accent2);color:#fff}
.player-row{display:flex;align-items:center;justify-content:space-between;padding:10px 0;border-bottom:1px solid #222}
.player-row:last-child{border-bottom:none}
.player-name{font-weight:600;font-size:1rem;flex:1}
.player-actions{display:flex;gap:6px;align-items:center}
.status-badge{font-size:.75rem;padding:3px 8px;border-radius:20px;font-weight:600}
.status-badge.out{background:var(--accent2);color:#fff}
.status-badge.alive{background:var(--green);color:#000}
.setup-players{display:flex;flex-direction:column;gap:8px;margin:12px 0}
.player-input-row{display:flex;gap:8px}
.player-input-row input{flex:1}
.player-input-row button{flex-shrink:0}
.round-info{text-align:center;color:var(--accent);font-weight:600;margin-bottom:12px;font-size:.9rem}
.history-item{padding:10px 0;border-bottom:1px solid #222;font-size:.85rem}
.history-item:last-child{border-bottom:none}
.history-date{color:var(--muted);font-size:.75rem}
.winner-banner{text-align:center;padding:20px;font-size:1.3rem;font-weight:700;color:var(--green)}
.tab-bar{display:flex;gap:0;margin-bottom:16px;border-radius:var(--radius);overflow:hidden;background:var(--card)}
.tab{flex:1;padding:10px;text-align:center;font-size:.85rem;font-weight:600;cursor:pointer;color:var(--muted);transition:all .2s}
.tab.active{background:var(--accent);color:#000}
.flex-center{display:flex;gap:8px;justify-content:center;margin-top:12px}
.empty{text-align:center;color:var(--muted);padding:30px;font-size:.9rem}
</style>
</head>
<body>

<h1>üõπ SKATE Score</h1>
<p class="subtitle">Digital Game of SKATE Scorekeeper</p>

<div class="tab-bar">
  <div class="tab active" data-tab="game" onclick="switchTab('game')">Game</div>
  <div class="tab" data-tab="history" onclick="switchTab('history')">History</div>
  <div class="tab" data-tab="stats" onclick="switchTab('stats')">Stats</div>
</div>

<div id="game-tab"></div>
<div id="history-tab" style="display:none"></div>
<div id="stats-tab" style="display:none"></div>

<script>
// --- Sound Effects (Web Audio API, no external files) ---
const AudioCtx = window.AudioContext || window.webkitAudioContext;
let audioCtx;
function ensureAudio() { if (!audioCtx) audioCtx = new AudioCtx(); return audioCtx; }

function playLetterSound() {
  const ctx = ensureAudio();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.type = 'triangle';
  osc.frequency.setValueAtTime(220, ctx.currentTime);
  osc.frequency.linearRampToValueAtTime(110, ctx.currentTime + 0.25);
  gain.gain.setValueAtTime(0.35, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.3);
  osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.3);
}

function playGameOverSound() {
  const ctx = ensureAudio();
  [0, 0.15, 0.3].forEach((t, i) => {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = 'square';
    osc.frequency.setValueAtTime([200, 160, 120][i], ctx.currentTime + t);
    gain.gain.setValueAtTime(0.25, ctx.currentTime + t);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + t + 0.18);
    osc.start(ctx.currentTime + t); osc.stop(ctx.currentTime + t + 0.2);
  });
}

function playWinSound() {
  const ctx = ensureAudio();
  [0, 0.12, 0.24, 0.36].forEach((t, i) => {
    const osc = ctx.createOscillator();
    const gain = ctx.createGain();
    osc.connect(gain); gain.connect(ctx.destination);
    osc.type = 'sine';
    osc.frequency.setValueAtTime([523, 659, 784, 1047][i], ctx.currentTime + t);
    gain.gain.setValueAtTime(0.3, ctx.currentTime + t);
    gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + t + 0.15);
    osc.start(ctx.currentTime + t); osc.stop(ctx.currentTime + t + 0.18);
  });
}

function playUndoSound() {
  const ctx = ensureAudio();
  const osc = ctx.createOscillator();
  const gain = ctx.createGain();
  osc.connect(gain); gain.connect(ctx.destination);
  osc.type = 'sine';
  osc.frequency.setValueAtTime(330, ctx.currentTime);
  osc.frequency.linearRampToValueAtTime(440, ctx.currentTime + 0.12);
  gain.gain.setValueAtTime(0.25, ctx.currentTime);
  gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.15);
  osc.start(ctx.currentTime); osc.stop(ctx.currentTime + 0.15);
}

// --- Haptics (Vibration API) ---
function vibrateShort() { if (navigator.vibrate) navigator.vibrate(50); }
function vibrateLong()  { if (navigator.vibrate) navigator.vibrate([100, 50, 100, 50, 200]); }

const WORD = 'SKATE';
let state = JSON.parse(localStorage.getItem('skate-state') || 'null');
let history = JSON.parse(localStorage.getItem('skate-history') || '[]');

function save() {
  localStorage.setItem('skate-state', JSON.stringify(state));
  localStorage.setItem('skate-history', JSON.stringify(history));
}

function switchTab(tab) {
  document.querySelectorAll('.tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab));
  ['game','history','stats'].forEach(t => {
    document.getElementById(t+'-tab').style.display = t === tab ? 'block' : 'none';
  });
  if (tab === 'game') renderGame();
  if (tab === 'history') renderHistory();
  if (tab === 'stats') renderStats();
}

function renderLetters(count) {
  return WORD.split('').map((l, i) =>
    `<div class="letter ${i < count ? 'active' : ''}">${l}</div>`
  ).join('');
}

function renderGame() {
  const el = document.getElementById('game-tab');
  if (!state) {
    el.innerHTML = `
      <div class="card">
        <h3 style="margin-bottom:12px">New Game</h3>
        <div class="setup-players" id="player-inputs">
          <div class="player-input-row"><input placeholder="Player 1" value="Player 1"><button class="danger sm" onclick="removePlayerInput(this)" style="display:none">‚úï</button></div>
          <div class="player-input-row"><input placeholder="Player 2" value="Player 2"><button class="danger sm" onclick="removePlayerInput(this)" style="display:none">‚úï</button></div>
        </div>
        <div class="flex-center">
          <button class="ghost" onclick="addPlayerInput()">+ Add Player</button>
        </div>
        <div class="flex-center" style="margin-top:16px">
          <button onclick="startGame()">Start Game üõπ</button>
        </div>
      </div>
      <div class="card">
        <h3 style="margin-bottom:8px">How to Play</h3>
        <p style="font-size:.85rem;color:var(--muted);line-height:1.5">
          One player sets a trick. Others must land it. Fail = get a letter (S-K-A-T-E). 
          Spell SKATE and you're out. Last one standing wins!
        </p>
      </div>`;
    updateRemoveButtons();
    return;
  }

  const alive = state.players.filter(p => p.letters < 5);
  if (alive.length <= 1) {
    const winner = alive[0] || state.players[0];
    el.innerHTML = `
      <div class="card">
        <div class="winner-banner">üèÜ ${winner.name} Wins!</div>
        <div style="text-align:center;color:var(--muted);font-size:.85rem;margin-bottom:12px">
          Round ${state.round} ‚Ä¢ ${state.players.length} players
        </div>
        ${state.players.map(p => `
          <div class="player-row">
            <span class="player-name">${p.name}</span>
            <div class="letters">${renderLetters(p.letters)}</div>
          </div>`).join('')}
        <div class="flex-center" style="margin-top:16px">
          <button onclick="endGame()">New Game</button>
        </div>
      </div>`;
    if (!state.saved) {
      history.unshift({ date: new Date().toISOString(), players: state.players.map(p=>({...p})), rounds: state.round, winner: winner.name, tricks: (state.tricks||[]).filter(t=>t.name) });
      state.saved = true;
      save();
    }
    return;
  }

  const setter = alive[state.currentSetter % alive.length];
  const currentTrick = (state.tricks || []).find(t => t.round === state.round);
  el.innerHTML = `
    <div class="round-info">Round ${state.round} ‚Äî ${setter.name} sets the trick</div>
    <div class="card" style="margin-bottom:12px">
      <div style="display:flex;gap:8px;align-items:center">
        <input id="trick-input" placeholder="Trick name (e.g. Kickflip)" value="${currentTrick ? currentTrick.name : ''}" style="flex:1" oninput="logTrick(this.value)">
      </div>
      ${(state.tricks||[]).length > 0 ? `<div style="margin-top:8px;font-size:.75rem;color:var(--muted)">Recent: ${(state.tricks||[]).slice(-3).map(t=>'R'+t.round+' '+t.name).join(' ‚Üí ')}</div>` : ''}
    </div>
    ${state.players.map((p, i) => {
      const isOut = p.letters >= 5;
      return `
      <div class="card" style="${isOut ? 'opacity:.4' : ''}">
        <div class="player-row" style="border:none">
          <div>
            <div class="player-name">${p.name}</div>
            <div class="letters" style="justify-content:flex-start;margin-top:4px">${renderLetters(p.letters)}</div>
          </div>
          <div class="player-actions">
            ${isOut ? '<span class="status-badge out">OUT</span>' :
              `<button class="danger sm" onclick="giveLetter(${i})">+ Letter</button>
               <button class="sm ghost" onclick="undoLetter(${i})" ${p.letters===0?'disabled style="opacity:.3"':''}>Undo</button>`
            }
          </div>
        </div>
      </div>`;
    }).join('')}
    <div class="flex-center">
      <button class="ghost" onclick="nextRound()">Next Round ‚Üí</button>
      <button class="danger sm" onclick="if(confirm('End this game?'))endGame()">End Game</button>
    </div>`;
}

function addPlayerInput() {
  const container = document.getElementById('player-inputs');
  const n = container.children.length + 1;
  const row = document.createElement('div');
  row.className = 'player-input-row';
  row.innerHTML = `<input placeholder="Player ${n}" value="Player ${n}"><button class="danger sm" onclick="removePlayerInput(this)">‚úï</button>`;
  container.appendChild(row);
  updateRemoveButtons();
}

function removePlayerInput(btn) {
  btn.parentElement.remove();
  updateRemoveButtons();
}

function updateRemoveButtons() {
  const rows = document.querySelectorAll('#player-inputs .player-input-row');
  rows.forEach(r => {
    r.querySelector('button').style.display = rows.length > 2 ? '' : 'none';
  });
}

function startGame() {
  const inputs = document.querySelectorAll('#player-inputs input');
  const names = [...inputs].map(i => i.value.trim()).filter(Boolean);
  if (names.length < 2) return alert('Need at least 2 players');
  state = { players: names.map(n => ({ name: n, letters: 0 })), round: 1, currentSetter: 0, saved: false, tricks: [] };
  save(); renderGame();
}

function logTrick(name) {
  if (!state || !state.tricks) state.tricks = [];
  const existing = state.tricks.find(t => t.round === state.round);
  const setter = state.players.filter(p => p.letters < 5)[state.currentSetter % state.players.filter(p => p.letters < 5).length];
  if (existing) { existing.name = name; existing.setter = setter.name; }
  else state.tricks.push({ round: state.round, name: name, setter: setter.name });
  save();
}

function giveLetter(idx) {
  if (state.players[idx].letters < 5) {
    state.players[idx].letters++;
    const isOut = state.players[idx].letters >= 5;
    const alive = state.players.filter(p => p.letters < 5);
    if (alive.length <= 1) {
      playWinSound(); vibrateLong();
    } else if (isOut) {
      playGameOverSound(); vibrateLong();
    } else {
      playLetterSound(); vibrateShort();
    }
    save(); renderGame();
  }
}

function undoLetter(idx) {
  if (state.players[idx].letters > 0) {
    state.players[idx].letters--;
    playUndoSound();
    save(); renderGame();
  }
}

function nextRound() {
  state.round++;
  state.currentSetter++;
  save(); renderGame();
}

function endGame() {
  state = null;
  save(); renderGame();
}

function renderHistory() {
  const el = document.getElementById('history-tab');
  if (!history.length) { el.innerHTML = '<div class="empty">No games played yet</div>'; return; }
  el.innerHTML = history.map(h => `
    <div class="card">
      <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:8px">
        <strong>üèÜ ${h.winner}</strong>
        <span class="history-date">${new Date(h.date).toLocaleDateString()}</span>
      </div>
      <div style="font-size:.85rem;color:var(--muted)">${h.rounds} rounds ‚Ä¢ ${h.players.length} players</div>
      ${(h.tricks||[]).length ? `<div style="margin:8px 0;font-size:.8rem"><strong style="color:var(--accent)">Tricks:</strong> ${h.tricks.map(t=>`<span style="color:var(--muted)">${t.name}${t.setter?' ('+t.setter+')':''}</span>`).join(' ‚Üí ')}</div>` : ''}
      ${h.players.map(p => `
        <div style="display:flex;justify-content:space-between;align-items:center;padding:4px 0;font-size:.85rem">
          <span>${p.name}</span>
          <div class="letters">${renderLetters(p.letters)}</div>
        </div>`).join('')}
    </div>`).join('');
}

function renderStats() {
  const el = document.getElementById('stats-tab');
  if (!history.length) { el.innerHTML = '<div class="empty">Play some games to see stats</div>'; return; }
  const players = {};
  history.forEach(h => {
    h.players.forEach(p => {
      if (!players[p.name]) players[p.name] = { wins: 0, games: 0, totalLetters: 0 };
      players[p.name].games++;
      players[p.name].totalLetters += p.letters;
      if (p.name === h.winner) players[p.name].wins++;
    });
  });
  const sorted = Object.entries(players).sort((a,b) => b[1].wins - a[1].wins);
  el.innerHTML = `
    <div class="card">
      <h3 style="margin-bottom:12px">Player Stats</h3>
      ${sorted.map(([name, s]) => `
        <div class="player-row">
          <div>
            <div class="player-name">${name}</div>
            <div style="font-size:.8rem;color:var(--muted)">${s.games} games ‚Ä¢ ${(s.totalLetters/s.games).toFixed(1)} avg letters</div>
          </div>
          <div style="text-align:right">
            <div style="font-size:1.1rem;font-weight:700;color:var(--green)">${s.wins}W</div>
            <div style="font-size:.75rem;color:var(--muted)">${Math.round(s.wins/s.games*100)}% win rate</div>
          </div>
        </div>`).join('')}
    </div>
    <div class="card">
      <h3 style="margin-bottom:8px">Overview</h3>
      <div style="font-size:.9rem;color:var(--muted)">
        Total games: ${history.length}<br>
        Total rounds: ${history.reduce((a,h)=>a+h.rounds,0)}<br>
        Unique players: ${sorted.length}
      </div>
    </div>`;
}

renderGame();
</script>
</body>
</html>
